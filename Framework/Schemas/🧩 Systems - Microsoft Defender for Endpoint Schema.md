#   



> 

| Name                                   | Field               | SubField         | SubSubField                     | SubSubSubField   | SubSubSubSubField   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Type    | Example                                                                                                                     |
|:---------------------------------------|:--------------------|:-----------------|:--------------------------------|:-----------------|:--------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------|:----------------------------------------------------------------------------------------------------------------------------|
| Schema identifier and version          | `schema`            |                  |                                 |                  |                     | Identifier of the schema at its current version                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | string  |                                                                                                                             |
| ‚ôªÔ∏è Status of the use-case              | `status`            |                  |                                 |                  |                     | Define the status according to use case development life cycle process                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | string  | STAGING                                                                                                                     |
| üë• Development Contributors             | `contributors`      |                  |                                 |                  |                     | Individuals who supported creating, enriching or tuning the detection.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | array   |                                                                                                                             |
| üè¢ Target Tenants                       | `tenants`           |                  |                                 |                  |                     | Override the default organizations and deploy to selected tenants only.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | array   |                                                                                                                             |
| üö© Flags                                | `flags`             |                  |                                 |                  |                     | Flags allow to customize the rule behaviour using the modifiers framework                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | array   |                                                                                                                             |
| ‚è≤ Rule Schedule                        | `scheduling`        |                  |                                 |                  |                     | Select the frequency by which the query will run and trigger alerts. If you set it to run less frequently, it will have a longer lookback duration.  Queries that run every 24 hours check the past 30 days. Queries that run every 12 hours check the past 48 hours. Queries that run every 3 hours check the past 12 hours. Queries that run every hour check the past 4 hours. Queries that run continuously check events as they are ingested into Microsoft Defender XDR.  NRT is supported for specific tables and columns. Please see the documentation for more details. https://learn.microsoft.com/en-us/defender-xdr/custom-detection-rules?view=o365-worldwide#continuous-nrt-frequency | string  |                                                                                                                             |
| üö® Alert Configuration                  | `alert`             |                  |                                 |                  |                     | Parameters used to configure the alert generated when the detection rule is triggered                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | object  |                                                                                                                             |
| üé´ Alert Title                          |                     | `title`          |                                 |                  |                     | Name of the alert triggered by the custom detection rule. By default, the name of the MDR will be used, but this parameter allows to override it.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |         |                                                                                                                             |
| Threat Category                        |                     | `category`       |                                 |                  |                     | Threat Category assigned to the alert triggered by the detection rule.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | string  | Malware                                                                                                                     |
| ATT&CK Techniques                      |                     | `techniques`     |                                 |                  |                     | Relevant techniques to map this rule onto. The available techniques are category-dependent, at the moment we do not provide a structured support to validate those techniques. You may refer to the GUI - create a mock detection rule, input the desired category, and see which techniques are presented. You may then input the relevant Technique IDs.                                                                                                                                                                                                                                                                                                                                          | array   |                                                                                                                             |
| üí£ Alert Severity                       |                     | `severity`       |                                 |                  |                     | Severity of the generated alert. By default, the alert_severity of the MDR is mapped to the severity, this parameter allows to override this behaviour.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | string  | Medium                                                                                                                      |
| Alert Response Recommendation          |                     | `recommendation` |                                 |                  |                     | Recommended actions to respond to the threat related to the alert triggered by the custom detection rule.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | string  |                                                                                                                             |
| Impacted Entities                      | `impacted_entities` |                  |                                 |                  |                     | Identify affected assets in your query results. They will be used to generate incidents and automate tasks.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | object  |                                                                                                                             |
| Device                                 |                     | `device`         |                                 |                  |                     | Represents a device that was identified in an alert triggered by a custom detection rule. Make sure that the column exists in the results of the query search.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | string  |                                                                                                                             |
| Mailbox                                |                     | `mailbox`        |                                 |                  |                     | Represents a mailbox that was identified in an alert triggered by a custom detection rule. Make sure that the column exists in the results of the query search.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | string  |                                                                                                                             |
| User                                   |                     | `user`           |                                 |                  |                     | Represents a user that was identified in an alert triggered by a custom detection rule. Make sure that the column exists in the results of the query search.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | string  |                                                                                                                             |
| Response Actions                       | `actions`           |                  |                                 |                  |                     | Describes the actions that will be taken after a detection is made by a custom detection rule.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | object  |                                                                                                                             |
| Device Response Actions                |                     | `devices`        |                                 |                  |                     | Choose applicable actions to take on entities found by your query.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | object  |                                                                                                                             |
| Device Isolation                       |                     |                  | `isolate_device`                |                  |                     | Describes a response action that uses Microsoft Defender to apply full network isolation to a device. This response action prevents the device from connecting to any application or service.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | string  |                                                                                                                             |
| Collection Investigation Package       |                     |                  | `collect_investigation_package` |                  |                     | Describes a response action that collects details for an investigation package.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | boolean |                                                                                                                             |
| Run Antivirus Scan                     |                     |                  | `run_antivirus_scan`            |                  |                     | Describes a response action that performs a full Microsoft Defender Antivirus scan on the device.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | boolean |                                                                                                                             |
| Initiate Investigation                 |                     |                  | `initiate_investigation`        |                  |                     | Describes a response action that starts an automated investigation of a device.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | boolean |                                                                                                                             |
| Restrict Application Execution         |                     |                  | `restrict_app_execution`        |                  |                     | Describes a response action that sets restrictions on device to allow only files that are signed with a Microsoft-issued certificate to run.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | boolean |                                                                                                                             |
| Files Response Actions                 |                     | `files`          |                                 |                  |                     | Choose applicable actions to take on entities found by your query.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | object  |                                                                                                                             |
| Allow/Block Files                      |                     |                  | `allow_block`                   |                  |                     | Describes a response action that allows or blocks a file to run on devices controlled by Microsoft Defender for Endpoint.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | object  |                                                                                                                             |
| Response Action Selection              |                     |                  |                                 | `action`         |                     | You may only select the allow or block action within a response  action for a detection rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | string  |                                                                                                                             |
| File Column Selection                  |                     |                  |                                 | `identifier`     |                     | Column Identifier that will be used for the file allow/block  response action. The column must exist in the results of the query search result                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | string  |                                                                                                                             |
| Device Groups                          |                     |                  |                                 | `groups`         |                     | Device groups to which the actions set in the custom detection rule are applied                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | object  |                                                                                                                             |
| Device Group Selection                 |                     |                  |                                 |                  | `selection`         | Select to which device group this response action will be applied to. If set to All - will apply to all endpoints, if set to Specific will require to select the relevant device groups                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | string  |                                                                                                                             |
| Selected Device groups                 |                     |                  |                                 |                  | `device_groups`     | Device groups to which this response action will be applied to                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | array   |                                                                                                                             |
| Stop and Quarantine File               |                     |                  | `quarantine_file`               |                  |                     | Response action that moves the file from its current location to quarantine.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | string  |                                                                                                                             |
| User Response Actions                  |                     | `users`          |                                 |                  |                     | Choose applicable actions to take on entities found by your query.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | object  |                                                                                                                             |
| Mark User as Compromised               |                     |                  | `mark_as_compromised`           |                  |                     | Describes a response action that sets the user's risk level to "high" in Microsoft Entra ID. This response action sets the user's risk level to high in Microsoft Entra ID, which triggers the identity protection policies for a high risk level.                                                                                                                                                                                                                                                                                                                                                                                                                                                  | string  |                                                                                                                             |
| Disable User                           |                     |                  | `disable_user`                  |                  |                     | Describes a response action that temporarily prevents a user from logging in to the on premises network.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | string  |                                                                                                                             |
| Force User Password Reset              |                     |                  | `force_password_reset`          |                  |                     | Describes a response action that prompts the user to change their password the next time they sign in.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | string  |                                                                                                                             |
| Alert Scope                            | `scope`             |                  |                                 |                  |                     | Scope of devices to which the alert will be triggered for                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | object  |                                                                                                                             |
| Device Group Selection                 |                     | `selection`      |                                 |                  |                     | Select to which device group this response action will be applied to. If set to All - will apply to all endpoints, if set to Specific will require to select the relevant device groups                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | string  |                                                                                                                             |
| Selected Device groups                 |                     | `device_groups`  |                                 |                  |                     | Device groups to which this response action will be applied to                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | array   |                                                                                                                             |
| üîé Defender For Endpoint Detection Rule | `query`             |                  |                                 |                  |                     | KQL Query                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | string  | DeviceFileEvents                                                                                                            |
|                                        |                     |                  |                                 |                  |                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |         | | where (ActionType == "FileCreated" and FileName endswith ".zip" and (FileOriginUrl != "" or FileOriginReferrerUrl != "")) |
| Tenant-Scoped Exclusions               | `exclusions`        |                  |                                 |                  |                     | This section adds exclusions, using queries that will be appended to the final query deployed in a per-tenant fashion, and fully documented. You may remove the tenant field, in which case the exclusion will apply to all tenants. You may add multiple exclusion section for the same tenant - in which case they  will be appended in the order that they appear.                                                                                                                                                                                                                                                                                                                               | array   |                                                                                                                             |
| Tenant                                 |                     | `tenant`         |                                 |                  |                     | The tenant to which the exclusion applied. Remove if the exclusion should be applied to all tenants.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | string  |                                                                                                                             |
| Exclusion Reason                       |                     | `reason`         |                                 |                  |                     | Document why the exclusion was added                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | string  |                                                                                                                             |
| üîé Exclusion Query                      |                     | `query`          |                                 |                  |                     | Write here the exclusion query, that will be appended to the base query                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | string  |                                                                                                                             |

### Template

``

```yaml
  schema: defender_for_endpoint::2.0
  status: DEVELOPMENT
  #contributors:
    #-
  #tenants:
    #-
  #flags:
    #-
  
  scheduling: 
  
  alert:
    #title: 
    category: 
    #techniques:
      #-
    #severity: 
    #recommendation: |
      #...
  
  impacted_entities:
    #device: 
    #mailbox: 
    #user: 
  
  #actions:
  
    #devices:
      #isolate_device: 
      #collect_investigation_package: false
      #run_antivirus_scan: false
      #initiate_investigation: false
      #restrict_app_execution: false
  
    #files:
      #allow_block:
        #action: 
        #identifier: 
        #groups:
          selection: 
          #device_groups:
            #-
      #quarantine_file: 
  
    #users:
      #mark_as_compromised: 
      #disable_user: 
      #force_password_reset: 
  
  scope:
    selection: All
    #device_groups:
      #-
  
  query: |
    ...
  
  #exclusions:
    #- tenant: 
      #reason: |
        #...
      #query: |
        #...
```

